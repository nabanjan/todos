<h1 id="title">{{.PageTitle}}</h1>
<style>
.done {
    color : green;
}
</style>
<ul>
    {{range .Todos}}
        {{if .Done}}
            <li class="done">{{.Todo}}</li>
        {{else}}
            <li>{{.Todo}}</li>
        {{end}}
    {{end}}
</ul>
<input id="input" type="text" />
<button onclick="createWebsocketAndAddTask()">Add Task</button>
<pre id="output"></pre>

<p id="add_task"></p>

<script>
    var input;
    var output;
    var title;
    var socket;
 
    function addTask() {
        try {
            socket.send(title.innerHTML + " " + input.value);
            input.value = "";
        } catch(err) {
            output.innerHTML = err.message;
        } finally {
            delete socket;
        }
    }

    function createWebsocketAndAddTask() {
        input = document.getElementById("input");
        output = document.getElementById("output");
        title = document.getElementById("title");
        socket = new WebSocket("ws://localhost:80/addTask");

        socket.onopen = function() {
            output.innerHTML = "Connected to server db\n";
            addTask();
        };

        socket.onmessage = function() {
            output.innerHTML += "Saved in server db\n";
        };
        
        setTimeout(function(){ 
                        output.innerHTML = "";
                        location.reload();
                    }, 3000);
     
    }
    //document.getElementById("add_task").innerHTML = "Add Task";
</script>